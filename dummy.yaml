# random seed of the model
seed: 42

logger_dir: "./logs"

model:

  # shape of the auxiliary variables
  auxiliary_shape: [16, 3]

  # definition of the flow model
  flow:

    # initial transform
    preprocessing:
      auxiliary_update:
        num_heads: 4
        num_dims: 64
        num_hidden: 1024
        num_blocks: 1
      displacement_encoder:
        num_heads: 4
        num_dims: 64
        num_hidden: 1024
        num_blocks: 1

    # coupling layers
    couplings:
      - num_repetitions: 1
        auxiliary_update:
          num_heads: 4
          num_dims: 64
          num_hidden: 1024
          num_blocks: 1
        position_update:
          num_heads: 4
          num_dims: 64
          num_hidden: 1024
          num_blocks: 1
        quaternion_update:
          num_heads: 4
          num_dims: 64
          num_hidden: 1024
          num_blocks: 1
      
  # base density
  base:
    rot_concentration: 40

  # target density
  target:
    cutoff_threshold:


# system definition
system:
  path: "./data/water"
  num_molecules: 16
  temperature: 250
  ice_type: Ih
  recompute_forces: false


# training definition
train:

  # first stage: only likelihood
  - num_epochs: 2
    num_iters_per_epoch: 1
    init_learning_rate: 0.001
    target_learning_rate: 0.000001
    weight_nll: 1.0
    weight_fm: 0.0
    weight_fe: 0.0
    fm_aggregation: mse
    num_samples: 128

  # first stage: only likelihood
  - num_epochs: 2
    num_iters_per_epoch: 1
    init_learning_rate: 0.001
    target_learning_rate: 0.000001
    weight_nll: 1.0
    weight_fm: 0.0
    weight_fe: 0.0
    fm_aggregation: mse
    num_samples: 128

  # second stage: likelihood with force-matching
  # - num_epochs: 1
  #   num_iters_per_epoch: 1
  #   init_learning_rate: 0.001
  #   target_learning_rate: 0.000001
  #   weight_nll: 1.0
  #   weight_fm: 0.1
  #   weight_fe: 0.0
  #   fm_aggregation: mse
  #   num_samples: 128