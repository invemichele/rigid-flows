# random seed of the model
seed: 42

global_step: 0

reporting:
  num_samples: 1000
  num_samples_per_batch: 1000
  plot_quaternions: null # [1, 5] 
  plot_oxygens: true
  plot_energy_histograms: true
  report_ess: true
  report_likelihood: false 
  save_model: false
  save_samples: false
  save_statistics: false

model:

  # set if model is trained with warm start
  pretrained_model_path: null # runs/2022-12-13_19:18:20/training_stage_0/epoch_1/model.eqx 

  # shape of the auxiliary variables
  auxiliary_shape: [16, 3]

  # definition of the flow model
  flow:

    # initial transform
    preprocessing:
      act_norm: true
      auxiliary_update:
        seq_len: 16
        activation: silu
        num_pos: 3
        num_dims: 64
        num_hidden: 64
        num_blocks: 2
        num_low_rank: 10
        low_rank_regularizer: 0.
        transform: gated
      position_encoder:
        seq_len: 16
        activation: silu
        num_dims: 64
        num_pos: 3
        num_hidden: 64
        num_blocks: 2

    # coupling layers
    couplings:
      - num_repetitions: 2
        auxiliary_update:
          seq_len: 16
          activation: silu
          num_pos: 3
          num_dims: 64
          num_hidden: 64
          num_blocks: 1
          num_low_rank: 10
          low_rank_regularizer: 0.
          transform: gated
        position_update:
          seq_len: 16
          activation: silu
          num_pos: 3
          num_dims: 64
          num_hidden: 64
          num_blocks: 2
          num_low_rank: 10
          low_rank_regularizer: 0.
          transform: gated
        quaternion_update:
          seq_len: 16
          activation: silu
          num_hidden: 64
          num_blocks: 2
        act_norm: true

  # base density
  base:
    rot_concentration: 40
    pos_concentration: 40

  # target density
  target:
    cutoff_threshold: null


# system definition
system:
  path: "/home/jonas/Downloads"
  num_molecules: 16
  temperature: 250
  ice_type: XI
  water_type: tip4pew
  recompute_forces: false
  store_forces: false
  forces_path: null
  fixed_box: true


# training definition
train:

  # first stage: only likelihood
  - num_epochs: 2
    num_iters_per_epoch: 1000
    init_learning_rate: 1e-3
    target_learning_rate: 1e-3
    weight_nll: 1.0
    weight_fm: 0
    weight_fe: 0
    weight_vg_model: 0
    weight_vg_target: 0
    fm_aggregation: null
    num_samples: 128
